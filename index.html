<!DOCTYPE html>
<html>
	<head>
		<script>
			var now_map = 0;
                        var play_bar = new image();
                        play_bar.src = "play_bar.png";
                        var labels;
		</script>
		<meta charset="utf-8">
		<title>2014九合一選舉</title>
		<script src="js/d3.js"></script>
		<script src="js/topojson.js"></script>
		<script src="js/jquery-1.11.1.js"></script>
		<script src="js/underscore.js"></script>
		<script src="js/queue.v1.js"></script>

		<script src="js/map.js"></script>

		<script src="js/jquery.keyframes.js"></script>
		<script src="js/prefixfree.js"></script>
		<!-- <script src="js/prefixfree.dynamic-dom.js"></script> -->
		

		<style>
		
			.title{
				font-size: 36px;
				margin-top: 6px;
				margin-left: 6px;
			}

			.sub-title{
				position: absolute;
				right: 0px;
				bottom: 0px;
				color: rgb(160,160,160);
			}

			.sm-text-en{	font-size: 15px;	}
			.bg-text-en{	font-size: 24px;	}
			.sm-text-ch{	font-size: 10px;	}
			.md-text-ch{	font-size: 15px;	}
			.bg-text-ch{ 	font-size: 18px;	}

			* {
				position: relative;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				box-sizing: border-box;
				font-family: Helvetica, Verdana, Arial, Tahoma, 微軟正黑體;
			}
			html, body {
				width: 100%;
				height: 100%;
				margin: 0; 
				padding: 0;
			}
			#mayor-map > svg {
				width: 600px;
				height: 630px;
			}
			#councilor-map > svg {
				width: 250px;
				height: 470px;
			}
			#difference-map > svg {
				width: 600px;
				height: 630px;
			}
			#difference-map{
				text-align:center;				
			}
			.county-area{ 
				cursor: pointer; 
			}
			.county-boundary {
				fill: none;
				stroke: white;
				stroke-linejoin: round;
			}

			#mayor-tooltip {
				position: absolute;
				width: 322px;
				overflow: auto;
				background: white;
				z-index: 1;
				padding: 16px 22px 28px 22px;
				box-shadow: 3px 3px 5px 2px rgba(0, 0, 0, 0.35);
			}
			#mayor-tooltip .region-info, #mayor-tooltip .region-title, #mayor-tooltip .region-table { 
				width: 278px; 
				font-size: 14pt;
			}
			#mayor-tooltip .region-info .region-title{
				height: 46px;
				line-height: 46px;
				font-size: 18pt;
				font-weight: bold;
				color: #505050;
			}
			
			#councilor-map {
				width: 250px;
				height: 470px;
				position: absolute;
				top: 159px;
			}
			#councilor-result {
				width: 645px;
				min-height: 550px;
				max-height: 550px;
				position: absolute;
				top: 148px;
				left: 278px;
				padding: 24px 0px 0px 24px;
				box-shadow: 3px 3px 5px 2px rgba(0, 0, 0, 0.35);
			}
			#councilor-result .region-info, #councilor-result .region-title, #councilor-result .region-table { 
				width: 582px; 
				font-size: 14pt;
			}
			#councilor-result .region-table{ margin-bottom: 14px; }
			#councilor-result .region-info .region-title{
				height: 32px;
				line-height: 32px;
				background: #dedede; 
				padding-left: 8px;
			}
			#councilor-result .region-thead, #councilor-result .candidate-result { position: absolute; }

			.region-thead, .candidate-result {
				border-bottom: 1px solid #a0a0a0; 
				overflow: hidden;
			}		
			.region-thead {
				font-size: 10pt; 
				color: #a0a0a0;
			}
			.region-thead > div, .candidate-result > div { 
				display: inline-block; 
				vertical-align: top;
				text-align: center;
				padding-top: 4px;
			}
			.candidate-result > .party, .region-thead > .party { width: 46px; }
			.candidate-result > .name, .region-thead > .name { width: 64px; }
			.candidate-result > .votes, .region-thead > .votes { width: 69px; }
			.candidate-result > .pct, .region-thead > .pct { width: 69px; }
			.candidate-result > .gender, .region-thead > .gender { width: 30px; }
			.candidate-result > .votes, .candidate-result > .pct { text-align: right; }
			.candidate-result > .gender, .candidate-result > .party { text-align: center; }
			.candidate-result img { 
				max-width: 30px;
				max-height: 20px;
			}
			#mayor-section, #councilor-section {
				width: 960px;
				min-height: 1000px;
				margin: 0 auto;
				padding-top: 60px
			}
			#mayor-map {
				margin-top: 42px;
			}
			#mayor-title, #councilor-title {
				height: 55px; 
				border-bottom: 1px solid #a0a0a0;
			}
			#mayor-title > .zh-title, #councilor-title > .zh-title {
				font-size: 28pt; 
				vertical-align: middle; 
				font-weight: bold; 
				color: #505050
			}
			#mayor-title > .en-title, #councilor-title > .en-title {
				position: absolute;
				right: 0px;
				bottom: 6px;
				font-size: 12pt; 
				color: #a0a0a0;
			}
			.logo {
				width: 35px; 
				height: 35px; 
				margin-right: 15px; 
				vertical-align: middle;
			}
			#councilor-seats {
				width: 582px; 
				height: 200px;
				position: absolute;
			}
			#councilor-seats .councilor-party {
				width: 380px;
				height: 145px;
				position: absolute;
				left: 101px;
				top: 41px;
			}
			#councilor-seats #party-seats-title {
				padding: 5px 0px 0px 5px;
				font-size: 15pt;
				color: #505050;
				font-weight: bold;
			}
			#councilor-tooltip {
				position: absolute;
				padding: 8px 8px 8px 8px;
				background: white;
				box-shadow: 3px 3px 5px 2px rgba(0, 0, 0, 0.35);
			}
			#councilor-seats svg g g path {
				cursor: pointer;
			}
			#councilor-info-wrapper {
				margin-top: 200px;
				height: 300px;
				max-height: 300px;
				overflow-y: auto;
			}
			#councilor-section ul li{
				cursor: pointer; 
				display: inline-block; 
				
				box-shadow: 3px 3px 5px 2px rgba(0, 0, 0, 0.35);
				margin: 0 5px;
			}
			#councilor-map {
				opacity: 1.0;
			}
			svg{
                        margin: 10px auto;
                	}
                	path {
                        	stroke:white;
                        	fill: grey;
                        	stroke-width:1px;
                        	opacity:1.0;
                	}
			.bar_container{
                        	height:30px;
                        	width:400px;
                	}
			#label_container{
				width:400px;
			}
                	.play_bar{
                        	z-index:1;
                        	margin: 0px auto;
                       		position:relative;
                        	top:15px;
                        	height:5px;
                        	width:400px;
                        	display:block;
                        	background:#AAA;
                	}
                	.bar_container img{
                        	position:relative;
                        	z-index:3;
                	}
                	.axis path,
                	.axis line {
                        	fill:none;
                        	stroke: #000;
                        	shape-rendering: crispEdges;
                	}
                	#article_container{
                        	margin: 0px auto;
                        	width:430px;
                        	position:absolute;
                        	left:700px;
                	}



			#progressbar {

			}

			#difference-map>div>div{
				z-index: 1000;
			    height: 10px;
			    border-radius: 5px;
			}

			#difference-map div.positive{
				animation:loadbarpositive 3s;
    			-webkit-animation:loadbarpositive 3s;
    			-moz-animation:loadbarpositive 3s
    			iterationCount: infinite;
				timingFunction: linear;
				-webkit-animation-iteration-count: infinite;
    			-webkit-animation-timing-function: linear;
			    -moz-animation-iteration-count: infinite;
			    -moz-animation-timing-function: linear;
			}
			#difference-map div.negative{
				animation:loadbarnegative 3s;
    			-webkit-animation:loadbarnegative 3s;
    			-moz-animation:loadbarnegative 3s
    			iterationCount: infinite;
				timingFunction: linear;
				-webkit-animation-iteration-count: infinite;
    			-webkit-animation-timing-function: linear;
			    -moz-animation-iteration-count: infinite;
			    -moz-animation-timing-function: linear;
			}
			#difference-map .kmt{
				background-color: #000094;
			}

			#difference-map .dpp{
				background-color: #009A52
			}

			@keyframes loadbarpositive {
			    0% {
			        width: 0%;
			    }
			    100% {
			        width: 100%;
			        
			    }
			}
			@-webkit-keyframes loadbarpositive {
			    0% {
			        width: 0%;
			    }
			    100% {
			        width: 100%;
			        
			    }
			}
			@keyframes loadbarnegative {
			    0% {
			        width: 0%;
			    }
			    100% {
			        width: 100%;
			    }
			    from{left:100%;}
  				to{left:0%;}
			}
			@-webkit-keyframes loadbarnegative {
			    
			    from{width: 0%;left:100%;}
  				to{width: 100%;left:0%;}
			}
		</style>
		<script>
		var margin_map = {'2010' : { kmt : [-8.45,-2.26,-8.6157,-7.775,-4.69,-28.75], dpp : [7.91,3.09,7.3724,9.82,12.435,3.39]}, 2014 : { kmt : [-14.83,-2.55,-4.2543,-8.18,-12.49,10.37], dpp : [15.26,1.39,5.3076,8.18,12.49,15.29]}};

		function drawMargin(year){
			var y = "" + year;
			var coefficient = 140/28.75;
			for (var i = 0;i < margin_map[y].kmt.length;i++){
					var w = Math.abs(margin_map[y].kmt[i]*coefficient);
					$("#kmt-"+i).css("width" , w +"px");
					if (margin_map[y]['kmt'][i] < 0){
						$("#kmt-"+i).css("left" , (parseInt($("#kmt-"+i).attr("data-left")) - w+10) +"px");
						$("#kmt-"+i + ">div").removeClass("positive").addClass("negative");
					}else {
						$("#kmt-"+i).css("left" , (parseInt($("#dpp-"+i).attr("data-left"))) +"px");
						$("#kmt-"+i + ">div").removeClass("negative").addClass("positive");
					}
				}
				for (var i = 0;i < margin_map[y].dpp.length;i++){
					var w = Math.abs(margin_map[y].dpp[i]*coefficient);
					$("#dpp-"+i).css("width" , w +"px");
					if (margin_map[y]['dpp'][i] < 0){
						$("#dpp-"+i).css("left" , (parseInt($("#dpp-"+i).attr("data-left")) - w+10) +"px");
						$("#dpp-"+i + ">div").removeClass("positive").addClass("negative");
					}else {
						$("#dpp-"+i).css("left" , (parseInt($("#dpp-"+i).attr("data-left"))) +"px");
						$("#dpp-"+i + ">div").removeClass("negative").addClass("positive");
					}
				}

		}
			$(document).ready(function(){
				//drawMargin(2014);
				drawMargin(2010);
				drawMargin(2014);
				



				// $.keyframe.define([{
				//     name: 'myfirst',
				//        '0%':   {width:"0px"},
				//     '100%': {width:"40px"}
				// }]);

				// $("#kmt-taipei").playKeyframe({
				//     name: 'myfirst',
				//     duration: '2s',
				//     iterationCount: 'infinite',
				//     timingFunction: 'ease',
    //         		direction: 'normal',
    //         		fillMode: 'forwards'

				// },function () {
    // 				console.log("hi")
				// });

			});

		</script>
	</head>
	<body>
	
		<div>
		<div id="mayor-title">
			<img class="logo" src="img/icon/logo.png" alt="logo">
			<span class="zh-title">藍鐵票區也搖擺 2014民進黨奪桃園</span>
			<span class="en-title">NINE-IN-ONE ELECTIONS</span>
		</div>
		<span class="bg-text-ch">觀音新屋復興20年無所動  大園政黨傾向不定</span>
		<object data="mySVG.svg" type="image/svg+xml" id="mySVG"></object>
		</div>
	
		<div class="article_container" id="article_container">
                        <p style="font-size:30px;">桃園市歷年村里長政黨變化圖</p>
                        <p>
                                左圖為民國79年到99年桃園縣各鄉鎮的村里長政黨多數比例圖，以該地區當年村里長當選人的多數政黨為顯示顏色，藍色代表國
民黨，綠色代表民進黨，灰色代表無黨籍。
                        </p>
                        <button id="play">Play</button>
                        <button id="turn_left"> &lt;</button>
                        <button id="turn_right"> &gt;</button>
                        <div class="bar_container" id="bar_container">
                                <div class="play_bar" id="play_bar">
                                </div>
                        </div>
                        <div id="label_container">
                        </div>
                </div>
                <svg id="svg1">
                </svg>
		<div id="difference-section" style="width:960px;margin-left:auto;margin-right:auto;">
			<div id="difference-map" style="position:relative">
				<div id="kmt-0" data-left="630" style="position:absolute;top:170px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-0" data-left="630" style="position:absolute;top:180px;">
					<div style="position:relative"class="dpp"></div>
				</div>
				<div id="kmt-1" data-left="640" style="position:absolute;top:195px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-1" data-left="640" style="position:absolute;top:205px;">
					<div style="position:relative"class="dpp"></div>
				</div>

				<div id="kmt-2" data-left="590" style="position:absolute;top:200px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-2" data-left="590"style="position:absolute;top:210px;">
					<div style="position:relative"class="dpp"></div>
				</div>
				<div id="kmt-3" data-left="540"style="position:absolute;top:300px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-3" data-left="540"style="position:absolute;top:310px;">
					<div style="position:relative"class="dpp"></div>
				</div>
				<div id="kmt-4" data-left="460"style="position:absolute;top:450px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-4" data-left="460" style="position:absolute;top:460px;">
					<div style="position:relative"class="dpp"></div>
				</div>
				<div id="kmt-5" data-left="520"style="position:absolute;top:470px;">
					<div style="position:relative"class="kmt"></div>
				</div>
				<div id="dpp-5" data-left="520"style="position:absolute;top:480px;">
					<div style="position:relative"class="dpp"></div>
				</div>
			</div>
		</div>
	</body>
	<script>
		 var width = 600;
                        var height = 800;
                        var svg = d3.select("#svg1")
                                        .attr("width", width)
                                        .attr("height", height);
                        var prj = d3.geo.mercator().center([121.75, 24.6]).scale(7500);
                        var path = d3.geo.path()
                                        .projection(prj);
                        
                        var g = svg.append("g");
                        d3.csv('csv/party_taiwan.csv',function(csv){
                                d3.json("json/twcounty2010.json", function(json1) {
                                         d3.json("json/twcounty1984.json", function(json2) {
                                                labels = unique_year(csv);      
                                                bind_data(json1,json2,csv);
                                        calculate_color(json1);
                                        calculate_color(json2);
                                        
                                        //alert(json2.features[0].properties.color);
                                        var map = svg.selectAll("path")
                                                .data(json2.features)
                                                .enter()
                                                .append("path")
                                                .attr("d",path)
                                                .style("fill",function(d){
                                                        return d.properties.color[0];
                                                });
                                        set_player(svg,json1,json2);
                                        });
                                });
                        });
	</script>
</html>
